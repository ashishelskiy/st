{% extends "service_track_app/base.html" %}
{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #{{ repair_request.id }} (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ){% endblock %}

{% block content %}
<div class="request-detail-section">
    <form method="POST" action="{% url 'request_detail' repair_request.id %}">
    {% csrf_token %}
    <div class="request-detail-header">
        <div class="request-detail-title">–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #{{ repair_request.id }} (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)</div>

        <div class="request-details-actions">
            <button class="action-btn btn-secondary" type="button" onclick="window.location.href='{% url 'my_requests' %}'">‚Üê –ù–∞–∑–∞–¥</button>
    <!--        <button class="action-btn btn-primary" id="saveRequestBtn" onclick="saveRequestDetails()" style="">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>-->
            <button class="action-btn btn-primary" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

        </div>
    </div>
        <div class="request-details-form">

<!--    <form method="POST" action="{% url 'update_request_status' repair_request.id %}">-->
<!--        {% csrf_token %}-->
        <input type="hidden" name="request_id" value="{{ repair_request.id }}">
<!--        <div class="form-group">-->
<!--            <label for="id_serial_number">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</label>-->
<!--            {{ form.serial_number }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_model_name">–ú–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞</label>-->
<!--            {{ form.model_name }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_purchase_date">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>-->
<!--            {{ form.purchase_date }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_warranty_status">–°—Ç–∞—Ç—É—Å –≥–∞—Ä–∞–Ω—Ç–∏–∏</label>-->
<!--            {{ form.warranty_status }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_problem_description">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏</label>-->
<!--            {{ form.problem_description }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_status">–°—Ç–∞—Ç—É—Å</label>-->
<!--            {{ form.status }}-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="id_problem_description">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>-->
<!--            {{ form.additional_notes }}-->
<!--        </div>-->
        <div class="details-row">
            <div class="details-group">
                <label for="id_serial_number" class="details-label">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞</label>
                {{ form.serial_number }}
            </div>
            <div class="details-group">
                <label for="id_model_name" class="details-label">–¢–æ–≤–∞—Ä</label>
                {{ form.product }}
            </div>
        </div>

        <div class="details-row">
            <div class="details-group">
                <label for="id_purchase_date" class="details-label">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>
                {{ form.purchase_date }}
            </div>
            <div class="details-group">
                <label for="id_warranty_status" class="details-label">–°—Ç–∞—Ç—É—Å –≥–∞—Ä–∞–Ω—Ç–∏–∏</label>
                {{ form.warranty_status }}
            </div>
        </div>

        <div class="details-row">
            <div class="details-group" style="grid-column: 1 / -1;">
                <label for="id_problem_description" class="details-label">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏</label>
                {{ form.problem_description }}
            </div>
        </div>

        <div class="details-row">
            <div class="details-group" style="grid-column: 1 / -1;">
                <label for="id_status" class="details-label">–°—Ç–∞—Ç—É—Å</label>
                {{ form.status }}
            </div>
        </div>
        <div class="details-row">
            <div class="details-group" style="grid-column: 1 / -1;">
                <label for="id_problem_description" class="details-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                {{ form.additional_notes }}
            </div>
        </div>
        <div class="details-row">
            <div class="details-group" style="grid-column: 1 / -1;">
                <div class="details-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</div>
                <div class="photo-gallery" id="detailsPhotoGallery">
                    {% if photos %}
                        {% for p in photos %}
<!--                            <div class="photo-item">-->
<!--                                <img src="{{ p.photo.url }}" alt="{{ p.photo.name }}" class="photo-image" onclick="viewPhoto('{{ p.photo.url }}')">-->
<!--                                <button class="photo-overlay" onclick="removePhoto({{ p.photo.id }})" title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>-->
<!--                            </div>-->
                            <div class="photo-item" style="position: relative; display: inline-block; margin: 5px; width: 150px; height: 150px; overflow: hidden; border-radius: 10px;">
                                <img src="{{ p.photo.url }}" alt="{{ p.photo.name }}"
                                     style="display: block; width: 100%; height: 100%; object-fit: cover; border-radius: 10px; cursor: pointer;"
                                     onclick="viewPhoto('{{ p.photo.url }}')">
                                <button class="photo-overlay"
                                        onclick="removePhoto({{ p.id }})"
                                        title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ"
                                        style="position:absolute; top:5px; right:5px; background:#0008; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">
                                    √ó
                                </button>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div style="color: #666; font-style: italic; padding: 20px; text-align: center;">
                            –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                        </div>
                    {% endif %}
<!--                    <div class="photo-item">-->
<!--                        <img src="MacheteMF-12RD2D4_1.png" alt="MacheteMF-12RD2D4_1.png" class="photo-image" onclick="viewPhoto('MacheteMF-12RD2D4_1.png')">-->
<!--                        <button class="photo-overlay" onclick="removePhoto(0)" title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>-->
<!--                    </div>-->

<!--                    <div class="photo-item">-->
<!--                        <img src="MacheteMF-12RD2D4_2.png" alt="MacheteMF-12RD2D4_2.png" class="photo-image" onclick="viewPhoto('MacheteMF-12RD2D4_2.png')">-->
<!--                        <button class="photo-overlay" onclick="removePhoto(1)" title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ">√ó</button>-->
<!--                    </div>-->
                </div>
            </div>
        </div>
        <div class="details-row">
            <div class="details-group" style="grid-column: 1 / -1;">
                <div class="details-label">–í–∏–¥–µ–æ</div>
                <div class="video-gallery" id="detailsVideoGallery">
                    {% if videos %}
                        {% for v in videos %}
<!--                            <div class="video-item" style="position: relative; display: inline-block; margin: 5px;">-->
<!--                                <video controls width="320" height="240" class="video-preview" style="border-radius: 10px;">-->
<!--                                    <source src="{{ v.video.url }}" type="video/mp4">-->
<!--                                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.-->
<!--                                </video>-->
<!--                                <button class="video-overlay"-->
<!--                                        onclick="removeVideo({{ v.id }})"-->
<!--                                        title="–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ"-->
<!--                                        style="position:absolute; top:5px; right:5px; background:#0008; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">-->
<!--                                    √ó-->
<!--                                </button>-->
<!--                            </div>-->
                            <div class="video-item" style="position: relative; display: inline-block; margin: 5px; width: 320px; height: 240px; overflow: hidden; border-radius: 10px;">
                                <video controls style="display: block; width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                                    <source src="{{ v.video.url }}" type="video/mp4">
                                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                                </video>
                                <button class="video-overlay"
                                        onclick="removeVideo({{ v.id }})"
                                        title="–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ"
                                        style="position:absolute; top:5px; right:5px; background:#0008; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">
                                    √ó
                                </button>
                            </div>

                        {% endfor %}
                    {% else %}
                        <div style="color: #666; font-style: italic; padding: 20px; text-align: center;">
                            –í–∏–¥–µ–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ -->

<!--        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>-->
        </div>
    </form>
</div>
<script>
function viewPhoto(url) {
    // –ü—Ä–æ—Å—Ç–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ç–æ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
    window.open(url, '_blank');
}
function viewVideo(url) {
    window.open(url, '_blank');
}
</script>
{% endblock %}
