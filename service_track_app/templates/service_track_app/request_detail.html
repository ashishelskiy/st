{% extends "service_track_app/base.html" %}
{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #{{ repair_request.id }} (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ){% endblock %}

{% block content %}
<div class="request-detail-section">
    <div class="breadcrumb">
        {% for crumb in breadcrumbs %}
            <span class="{% if forloop.last %}breadcrumb-current{% else %}breadcrumb-item{% endif %}"
                  {% if not forloop.last %}onclick="window.location.href='{{ crumb.url }}'" style="cursor: pointer;"{% endif %}>
                {% if forloop.first %}üì¶{% endif %} {{ crumb.title }}
            </span>
            {% if not forloop.last %}
                <span class="breadcrumb-separator">‚Ä∫</span>
            {% endif %}
        {% endfor %}
    </div>
    <div class="request-details-actions">
        <button class="action-btn btn-secondary" type="button"
            onclick="window.location.href='{{ back_url }}'">
            ‚Üê –ö {{ back_title }}
        </button>
    <!--        <button class="action-btn btn-primary" id="saveRequestBtn" onclick="saveRequestDetails()" style="">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>-->
        <button class="action-btn btn-primary" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    <form method="POST" action="{% url 'request_detail' repair_request.id %}">
        {% csrf_token %}
        <div class="request-detail-header">
            <div class="request-detail-title">–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #{{ repair_request.id }} (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)</div>
        </div>
        <div class="request-details-form">
            <input type="hidden" name="request_id" value="{{ repair_request.id }}">
            <div class="details-row">
                <div class="details-group">
                    <label for="id_serial_number" class="details-label">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞</label>
                    {{ form.serial_number }}
                </div>
                <div class="details-group">
                    <label for="id_model_name" class="details-label">–¢–æ–≤–∞—Ä</label>
                    {{ form.product }}
                </div>
            </div>
            <div class="details-row">
                <div class="details-group">
                    <label for="id_purchase_date" class="details-label">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>
                    {{ form.purchase_date }}
                </div>
                <div class="details-group">
                    <label for="id_warranty_status" class="details-label">–°—Ç–∞—Ç—É—Å –≥–∞—Ä–∞–Ω—Ç–∏–∏</label>
                    {{ form.warranty_status }}
                </div>
            </div>
            <div class="details-row">
                <div class="details-group" style="grid-column: 1 / -1;">
                    <label for="id_problem_description" class="details-label">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏</label>
                    {{ form.problem_description }}
                </div>
            </div>
            <div class="details-row">
                <div class="details-group" style="grid-column: 1 / -1;">
                    <label for="id_status" class="details-label">–°—Ç–∞—Ç—É—Å</label>
                    {{ form.status }}
                </div>
            </div>
            <div class="details-row">
                <div class="details-group" style="grid-column: 1 / -1;">
                    <label for="id_problem_description" class="details-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                    {{ form.additional_notes }}
                </div>
            </div>
            <div class="details-row">
                <div class="details-group" style="grid-column: 1 / -1;">
                    <div class="details-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</div>
                    <div class="photo-gallery" id="detailsPhotoGallery">
                        {% if photos %}
                            {% for p in photos %}
                                <div class="photo-item" style="position: relative; display: inline-block; margin: 5px; width: 150px; height: 150px; overflow: hidden; border-radius: 10px;">
                                    <img src="{{ p.photo.url }}" alt="{{ p.photo.name }}"
                                         style="display: block; width: 100%; height: 100%; object-fit: cover; border-radius: 10px; cursor: pointer;"
                                         onclick="viewPhoto('{{ p.photo.url }}')">
                                    <button class="photo-overlay"
                                            onclick="removePhoto({{ p.id }})"
                                            title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ"
                                            style="position:absolute; top:5px; right:5px; background:#0008; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">
                                        √ó
                                    </button>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div style="color: #666; font-style: italic; padding: 20px; text-align: center;">
                                –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="details-row">
                <div class="details-group" style="grid-column: 1 / -1;">
                    <div class="details-label">–í–∏–¥–µ–æ</div>
                    <div class="video-gallery" id="detailsVideoGallery">
                        {% if videos %}
                            {% for v in videos %}
                                <div class="video-item" style="position: relative; display: inline-block; margin: 5px; width: 320px; height: 240px; overflow: hidden; border-radius: 10px;">
                                    <video controls style="display: block; width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                                        <source src="{{ v.video.url }}" type="video/mp4">
                                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                                    </video>
                                    <button class="video-overlay"
                                            onclick="removeVideo({{ v.id }})"
                                            title="–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ"
                                            style="position:absolute; top:5px; right:5px; background:#0008; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">
                                        √ó
                                    </button>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div style="color: #666; font-style: italic; padding: 20px; text-align: center;">
                                –í–∏–¥–µ–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<script>
function viewPhoto(url) {
    window.open(url, '_blank');
}
function viewVideo(url) {
    window.open(url, '_blank');
}
</script>
{% endblock %}
