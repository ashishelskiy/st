{% extends "service_track_app/base.html" %}
{% block title %}–ú–æ–∏ –∑–∞—è–≤–∫–∏{% endblock %}

{% block content %}
<div class="requests-section">
    <form method="post" action="{% url 'my_requests' %}">
    {% csrf_token %}
    <div class="requests-header">
        <div class="requests-title">–ú–æ–∏ –∑–∞—è–≤–∫–∏</div>
<!--        <button id="sendSelectedBtn" class="send-selected-btn" onclick="sendSelectedRequests()">-->
<!--            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é-->
<!--        </button>-->
        <button type="submit" id="sendSelectedBtn" class="send-selected-btn">
                üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é
            </button>
    </div>

    {% if requests %}
<!--        <form method="post" action="{% url 'send_selected_requests' %}">-->
<!--        <form method="post" action="{% url 'my_requests' %}">-->
<!--            {% csrf_token %}-->
            <div class="requests-table-container">
            <table class="requests-table">
                <thead>
                    <tr>
                        <th>
<!--                            <input type="checkbox" class="request-checkbox request-select" id="select-all" onchange="toggleSelectAll()">-->
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="request-checkbox">
                        </th>
                        <th>‚Ññ –∑–∞—è–≤–∫–∏</th>
                        <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                        <th>–ú–æ–¥–µ–ª—å</th>
                        <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                        <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                        <th>–ì–∞—Ä–∞–Ω—Ç–∏—è</th>
<!--                        <th>–°—Ç–∞—Ç—É—Å</th>-->
                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in requests %}
                        <tr class="request-row" onclick="window.location.href='{% url 'request_detail' r.id %}'">
                            <td>
                                <input type="checkbox" class="request-checkbox request-select" name="selected_requests" value="{{ r.id }}" onclick="event.stopPropagation()" onchange="updateSendButton()">
                            </td>
                            <td class="request-id">#{{ r.id }}</td>
                            <td>{{ r.serial_number }}</td>
                            <td>{{ r.model_name }}</td>
                            <td>{{ r.customer_name }}</td>
                            <td title="{{ r.problem_description }}">
                                {{ r.problem_description|truncatechars:50 }}
                            </td>
<!--                            <td>-->
<!--                                {% if r.warranty_status == "warranty" %}-->
<!--                                    <span class="request-status status-sent">–ù–∞ –≥–∞—Ä–∞–Ω—Ç–∏–∏</span>-->
<!--                                {% elif r.warranty_status == "expired" %}-->
<!--                                    <span class="request-status status-created">–ì–∞—Ä–∞–Ω—Ç–∏—è –∏—Å—Ç–µ–∫–ª–∞</span>-->
<!--                                {% else %}-->
<!--                                    <span class="request-status status-created">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>-->
<!--                                {% endif %}-->
<!--                            </td>-->
                            <td>
                                {% if r.status == "warranty" %}
                                    <span class="request-status status-sent">–ù–∞ –≥–∞—Ä–∞–Ω—Ç–∏–∏</span>
                                {% elif r.status == "expired" %}
                                    <span class="request-status status-created">–ì–∞—Ä–∞–Ω—Ç–∏—è –∏—Å—Ç–µ–∫–ª–∞</span>
                                {% else %}
                                    <span class="request-status status-created">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td class="request-date">{{ r.created_at|date:"d.m.Y H:i" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
<!--            <button type="submit" id="sendSelectedBtn" class="send-selected-btn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é</button>-->
<!--        </form>-->
    {% elif request.GET.sent == '1' and request.GET.all_sent == '1' %}
    <div id="requestsTableContainer">
        <div class="empty-state">
            <div class="empty-state-icon">‚úÖ</div>
            <div class="empty-state-text">–í—Å–µ –∑–∞—è–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã</div>
            <div class="empty-state-subtext">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é</div>
        </div>
    </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <div class="empty-state-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫</div>
            <div class="empty-state-subtext">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É –≤–æ –≤–∫–ª–∞–¥–∫–µ "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É"</div>
        </div>
    {% endif %}
    </form>
</div>
{# ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Django messages #}
{% if messages %}
    <div>
        {% for message in messages %}
            <div class="notification">
<!--            <div id="notification" class="notification success">-->
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
<!--<div id="notification" class="notification success">–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 1 –∑–∞—è–≤–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é!</div>-->
<script>
    // –≤—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ
    /*
    document.getElementById('select-all').addEventListener('change', function() {
        let checkboxes = document.querySelectorAll('input[name="selected_requests"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });
    */

     function toggleSelectAll() {
        const selectAll = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('.request-select');

        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAll.checked;
        });

        updateSendButton();
     }

    function updateSendButton() {
        const checkboxes = document.querySelectorAll('.request-select:checked');
        const sendBtn = document.getElementById('sendSelectedBtn');

        if (checkboxes.length > 0) {
            sendBtn.classList.add('enabled');
            sendBtn.textContent = `üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ (${checkboxes.length}) –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é`;
        } else {
            sendBtn.classList.remove('enabled');
            sendBtn.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é';
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
            const notifications = document.querySelectorAll('.notification');

            notifications.forEach(n => {
                // –ü–æ–∫–∞–∑–∞—Ç—å
                n.classList.add('show');

                // –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ —Å–∫—Ä—ã—Ç—å
                setTimeout(() => {
                    n.classList.remove('show');
                }, 5000); // 5000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ = 5 —Å–µ–∫—É–Ω–¥
            });
        });
</script>
{% endblock %}