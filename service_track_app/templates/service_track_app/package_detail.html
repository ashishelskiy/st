{% extends "service_track_app/base.html" %}
{% block title %}–ü–∞–∫–µ—Ç {{ p.id }}{% endblock %}

{% block content %}
<div id="sentSection" class="section active">
<div class="sent-requests-section">
    <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="window.location.href='{% url 'sent_requests' %}'">üì¶ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã</span>
        <span class="breadcrumb-separator" id="breadcrumbSeparator" style="display: inline;">‚Ä∫</span>
        <span class="breadcrumb-current" id="breadcrumbCurrent" style="display: inline;">–ü–∞–∫–µ—Ç –æ—Ç {{ p.created_at|date:"d.m.Y" }}</span>
    </div>
    <div id="packageDetailsContainer" class="package-details active">
        <button class="back-btn" onclick="window.location.href='{% url 'sent_requests' %}'">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–∞–∫–µ—Ç–æ–≤</button>
<!--        <div class="requests-title" id="packageDetailsTitle">–ó–∞—è–≤–∫–∏ –≤ –ø–∞–∫–µ—Ç–µ –æ—Ç {{ p.created_at|date:"d.m.Y" }} ({{ p.request_count }} —à—Ç.)</div>-->
        <div class="requests-title" id="packageDetailsTitle">{{ p.dealer_company }} –æ—Ç {{ p.created_at|date:"d.m.Y" }}</div>
        <div id="packageRequestsContainer">
            <div class="package-requests-table-container">
                <table class="package-requests-table">
                    <thead>
                        <tr>
                            <th>‚Ññ –∑–∞—è–≤–∫–∏</th>
                            <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                            <th>–ú–æ–¥–µ–ª—å</th>
                            <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                            <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                            <th>–ì–∞—Ä–∞–Ω—Ç–∏—è</th>
                            <th>–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in requests %}
                        <tr class="package-request-row" onclick="openRequestDetail({{ r.id }})">
                            <td data-label="‚Ññ –∑–∞—è–≤–∫–∏" class="request-id">#{{ r.id }}</td>
                            <td data-label="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä">{{ r.serial_number }}</td>
                            <td data-label="–ú–æ–¥–µ–ª—å">{{ r.model_name }}</td>
                            <td data-label="–ü–æ–∫—É–ø–∞—Ç–µ–ª—å">{{ r.customer_name }}</td>
                            <td data-label="–ü—Ä–æ–±–ª–µ–º–∞" title="{{ r.problem_description|truncatechars:50 }}">
                                {{ r.problem_description|truncatechars:50 }}
                            </td>
                            <td data-label="–ì–∞—Ä–∞–Ω—Ç–∏—è">
                                {% if r.status == "warranty" %}
                                    <span class="request-status status-sent">–ù–∞ –≥–∞—Ä–∞–Ω—Ç–∏–∏</span>
                                {% elif r.status == "expired" %}
                                    <span class="request-status status-created">–ì–∞—Ä–∞–Ω—Ç–∏—è –∏—Å—Ç–µ–∫–ª–∞</span>
                                {% else %}
                                    <span class="request-status status-created">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td data-label="–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏" class="request-date">{{ r.sent_at|date:"H:i" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    function openRequestDetail(requestId) {
        window.location.href = `{% url 'request_detail' 0 %}`.replace('0', requestId);
    }

    // –ß—Ç–æ–±—ã –∫–ª–∏–∫ –ø–æ —á–µ–∫–±–æ–∫—Å—É –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞—è–≤–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.received-checkbox').forEach(checkbox => {
            checkbox.addEventListener('click', function(e) {
                e.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
            });
        });
    });
</script>
{% endblock %}