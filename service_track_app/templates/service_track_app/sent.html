{% extends "service_track_app/base.html" %}
{% block title %}–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ{% endblock %}

{% block content %}
<div class="sent-requests-section">
    <div class="sent-requests-section">
        <div class="breadcrumb">
            <span class="breadcrumb-item" onclick="window.location.href='{% url 'sent_requests' %}'">üì¶ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã</span>
            <span class="breadcrumb-separator" id="breadcrumbSeparator" style="display: none;">‚Ä∫</span>
            <span class="breadcrumb-current" id="breadcrumbCurrent" style="display: none;"></span>
        </div>

        <div class="filters-section">
            <div class="filters-header">
<!--                <span class="filters-title">–§–∏–ª—å—Ç—Ä—ã:</span>-->
                <div class="filters-container">
                    <a href="?status=all" class="filter-btn {% if current_status == 'all' or not current_status %}filter-btn-active{% endif %}">
                        <span class="filter-icon">üì¶</span>
                        –í—Å–µ –ø–∞–∫–µ—Ç—ã
                    </a>
                    <a href="?status=sent" class="filter-btn {% if current_status == 'sent' %}filter-btn-active{% endif %}">
                        <span class="filter-icon">üì§</span>
                        –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ
                    </a>
                    <a href="?status=accepted" class="filter-btn {% if current_status == 'accepted' %}filter-btn-active{% endif %}">
                        <span class="filter-icon">‚úÖ</span>
                        –ü—Ä–∏–Ω—è—Ç—ã–µ
                    </a>
                    <a href="?status=returned" class="filter-btn {% if current_status == 'returned' %}filter-btn-active{% endif %}">
                        <span class="filter-icon">‚Ü©Ô∏è</span>
                        –í–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–µ
                    </a>
                </div>
            </div>
        </div>

        <div id="packagesListContainer">
            <div class="requests-title" style="margin-bottom: 30px;">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∑–∞—è–≤–æ–∫</div>
            <div id="packagesContainer">
                {% if packages %}
                {% for p in packages %}
                <div class="package-card">
                    <div class="package-header" onclick="window.location.href='{% url 'package_detail' p.id %}'" style="cursor: pointer;">
                        <div class="package-date">üì¶ {{ p.dealer_company }} –æ—Ç {{ p.created_at|date:"d.m.Y" }}</div>
                        <div class="package-status status-{{ p.status }}">
                            {% if p.status == 'returned' %}‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—â–µ–Ω{% endif %}
                            {% if p.status == 'sent' %}üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω{% endif %}
                            {% if p.status == 'accepted' %}‚úÖ –ü—Ä–∏–Ω—è—Ç{% endif %}
                        </div>
                        <div class="package-count">{{ p.requests.count }} –∑–∞—è–≤–æ–∫</div>
                    </div>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–∞–∫–µ—Ç–∞ -->
                    <div class="package-requests-mini-table">
                        <table class="mini-requests-table">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞</th>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–°—Ç–∞—Ç—É—Å –≥–∞—Ä–∞–Ω—Ç–∏–∏</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in p.requests.all %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ r.serial_number }}</td>
                                    <td>{{ r.product.display_name|truncatechars:40  }}</td>
                                    <td>
                                        {% if r.warranty_status == "warranty" %}
                                            <span class="request-status status-sent">–ù–∞ –≥–∞—Ä–∞–Ω—Ç–∏–∏</span>
                                        {% elif r.warranty_status == "paid_repair" %}
                                            <span class="request-status status-created">–ü–ª–∞—Ç–Ω—ã–π —Ä–µ–º–æ–Ω—Ç</span>
                                        {% elif r.warranty_status == "diagnostics" %}
                                            <span class="request-status status-created">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</span>
                                        {% else %}
                                            <span class="request-status status-created">{{ r.get_warranty_status_display }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–∞–∫–µ—Ç–æ–≤</div>
                    </div>
                {% endif %}
            </div>
        </div>

        <div id="packageDetailsContainer" class="package-details">
            <button class="back-btn" onclick="showPackagesList()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–∞–∫–µ—Ç–æ–≤</button>
            <div class="requests-title" id="packageDetailsTitle"></div>
            <div id="packageRequestsContainer">
                <!-- –ó–∞—è–≤–∫–∏ –ø–∞–∫–µ—Ç–∞ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã JavaScript -->
            </div>
        </div>
    </div>
</div>
{% endblock %}