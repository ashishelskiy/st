{% extends "service_track_app/base.html" %}
{% block title %}–ü–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –∑–∞—è–≤–∫–∏{% endblock %}

{% block content %}
<div class="received-section">

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ -->
    <div class="filter-controls">
        <button type="button" onclick="toggleReceivedView('packages')">üì¶ –ü–∞–∫–µ—Ç—ã</button>
        <button type="button" onclick="toggleReceivedView('requests')">üìÑ –ó–∞—è–≤–∫–∏</button>
        <select id="statusFilter" onchange="filterReceivedStatus(this.value)">
            <option value="all">–í—Å–µ</option>
            <option value="received">–ü–æ—Å—Ç—É–ø–∏–ª</option>
            <option value="inprogress">–í —Ä–∞–±–æ—Ç–µ</option>
            <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
        </select>
    </div>

    <!-- –ë–ª–æ–∫ —Å –ø–∞–∫–µ—Ç–∞–º–∏ -->
    <div id="receivedPackages" style="display:block;">
        {% for p in packages %}
        <div class="package-card" onclick="window.location.href='{% url 'package_detail' p.id %}'">
            <div class="package-header">
<!--                <div class="package-date">üì¶ –ü–∞–∫–µ—Ç –æ—Ç {{ p.created_at|date:"d.m.Y" }}</div>-->
                <div class="package-date">üì¶ {{ p.dealer_company }} –æ—Ç {{ p.created_at|date:"d.m.Y" }}</div>
                <div class="package-count">{{ p.request_count }} –∑–∞—è–≤–æ–∫</div>
            </div>
            <div class="package-info">
                <div class="package-info-item">
                    <span>üïí</span>
                    <span>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ {{ p.created_at|date:"H:i" }}</span>
                </div>
<!--                <div class="package-info-item">-->
<!--                    <span>üè¢</span>-->
<!--                    <span>{{ p.dealer_company }}</span>-->
<!--                </div>-->
            </div>
        </div>
        {% empty %}
            <p>–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤</p>
        {% endfor %}
    </div>

    <!-- –ë–ª–æ–∫ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞—è–≤–∫–∞–º–∏ -->
    <div id="receivedRequests" style="display:none;">
        <table class="requests-table">
            <thead>
                <tr>
                    <th>‚Ññ –∑–∞—è–≤–∫–∏</th>
                    <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                    <th>–ú–æ–¥–µ–ª—å</th>
                    <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                    <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for r in repair_requests %}
                <tr class="request-row" onclick="window.location.href='{% url 'request_detail' r.id %}'">
                    <td>#{{ r.id }}</td>
                    <td>{{ r.serial_number }}</td>
                    <td>{{ r.model_name }}</td>
                    <td>{{ r.customer_name }}</td>
                    <td>{{ r.problem_description|truncatechars:50 }}</td>
                    <td>{{ r.get_status_display }}</td>
                    <td>{{ r.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
                {% empty %}
                    <tr><td colspan="7">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
function toggleReceivedView(view) {
    document.getElementById('receivedPackages').style.display = (view === 'packages') ? 'block' : 'none';
    document.getElementById('receivedRequests').style.display = (view === 'requests') ? 'block' : 'none';
}

// –ü—Ä–∏–º–µ—Ä —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
function filterReceivedStatus(status) {
    let rows = document.querySelectorAll('#receivedRequests tbody tr');
    rows.forEach(row => {
        if (status === 'all' || row.cells[5].textContent.toLowerCase() === status.toLowerCase()) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>

{% endblock %}
